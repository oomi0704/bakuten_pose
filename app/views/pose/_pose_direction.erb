<html>
  <head>
    <title>pose detection</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
    <script src="/javascripts/pose_direction.js"></script>
    <meta charset="UTF-8">
  </head>
  
  <body>
    <div id="container">
    
      <% if @user.stand_image.present? %>
        <%= image_tag @user.stand_image.url, id: 'img', width: '500px', alt: 'Stand Image', crossorigin: 'anonymous' %>
      <% else %>
        <%= image_tag 'stand.jpeg', id: 'img', width: '500px', alt: 'Stand Image', crossorigin: 'anonymous' %>
      <% end %>
      <canvas id="canvas" ></canvas> 
    </div>

    <button id="start-button">診断開始</button>
    

    <table id="first-table">
      <tr>
        <th>部位</th>
        <th>スコア(%)</th>
        <th>x座標</th>
        <th>y座標</th>
      </tr>
      <tr>
        <td>鼻</td>
        <td id="nose-score">-</td>
        <td id="nose-x">-</td>
        <td id="nose-y">-</td>
      </tr>
      <tr>
        <td>左目</td>
        <td id="left-eye-score">-</td>
        <td id="left-eye-x">-</td>
        <td id="left-eye-y">-</td>
      </tr>
      <tr>
        <td>右目</td>
        <td id="right-eye-score">-</td>
        <td id="right-eye-x">-</td>
        <td id="right-eye-y">-</td>
      </tr>
      <tr>
        <td>左耳</td>
        <td id="left-ear-score">-</td>
        <td id="left-ear-x">-</td>
        <td id="left-ear-y">-</td>
      </tr>
      <tr>
        <td>右耳</td>
        <td id="right-ear-score">-</td>
        <td id="right-ear-x">-</td>
        <td id="right-ear-y">-</td>
      </tr>
      <tr>
        <td>左肩</td>
        <td id="left-shoulder-score">-</td>
        <td id="left-shoulder-x">-</td>
        <td id="left-shoulder-y">-</td>
      </tr>
      <tr>
        <td>右肩</td>
        <td id="right-shoulder-score">-</td>
        <td id="right-shoulder-x">-</td>
        <td id="right-shoulder-y">-</td>
      </tr>
      <tr>
        <td>左肘</td>
        <td id="left-elbow-score">-</td>
        <td id="left-elbow-x">-</td>
        <td id="left-elbow-y">-</td>
      </tr>
      <tr>
        <td>右肘</td>
        <td id="right-elbow-score">-</td>
        <td id="right-elbow-x">-</td>
        <td id="right-elbow-y">-</td>
      </tr>
      <tr>
        <td>左手首</td>
        <td id="left-wrist-score">-</td>
        <td id="left-wrist-x">-</td>
        <td id="left-wrist-y">-</td>
      </tr>
      <tr>
        <td>右手首</td>
        <td id="right-wirst-score">-</td>
        <td id="right-wirst-x">-</td>
        <td id="right-wirst-y">-</td>
      </tr>
      <tr>
        <td>左腰</td>
        <td id="left-hip-score">-</td>
        <td id="left-hip-x">-</td>
        <td id="left-hip-y">-</td>
      </tr>
      <tr>
        <td>右腰</td>
        <td id="right-hip-score">-</td>
        <td id="right-hip-x">-</td>
        <td id="right-hip-y">-</td>
      </tr>
      <tr>
        <td>左膝</td>
        <td id="left-knee-score">-</td>
        <td id="left-knee-x">-</td>
        <td id="left-knee-y">-</td>
      </tr>
      <tr>
        <td>右膝</td>
        <td id="right-knee-score">-</td>
        <td id="right-knee-x">-</td>
        <td id="right-knee-y">-</td>
      </tr>
      <tr>
        <td>左足首</td>
        <td id="left-ankle-score">-</td>
        <td id="left-ankle-x">-</td>
        <td id="left-ankle-y">-</td>
      </tr>
      <tr>
        <td>右足首</td>
        <td id="right-ankle-score">-</td>
        <td id="right-ankle-x">-</td>
        <td id="right-ankle-y">-</td>
      </tr>
    </table>

    <table id="knee-angle-table">
      <tr>
        <th>膝の角度</th>
      </tr>
      <tr>
        <td>膝の角度</td>
        <td id="knee-angle-score">-</td>
      </tr>
    </table>  

    <script src="/javascripts/pose_direction.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const startButton = document.getElementById('start-button');
        if (startButton) {
          startButton.addEventListener('click', function() {
            startPoseDetection(); // pose_direction.js内の関数を呼び出す
          });
        }
      });
    </script>

  </body>
</html>
